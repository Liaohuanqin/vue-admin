<template>
<section>
    <el-input v-model="relates"></el-input>
    <table class="table">
        <thead>
            <tr>
                <th>组件名</th>
                <th>组件值</th>
                <th>组件实例</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>field_tag</td>
                <td>{{field_tag}}</td>
                <td>
                    <field_tag 
                        v-model="field_tag" 
                        :candidate="field_tag_candidate"
                        :handleInvalidValue="handleTagInvalid"
                    ></field_tag>
                </td>
            </tr>
            <tr>
                <td>field_tag_json</td>
                <td>{{field_tag_json}} || {{typeof field_tag_json}}</td>
                <td>
                    <field_tag_json 
                        v-model="field_tag_json" 
                        :candidate="field_tag_candidate"
                        :handleInvalidValue="handleTagInvalid"
                    ></field_tag_json>
                </td>
            </tr>



            <tr>
                <td>field_async_tag</td>
                <td>{{field_async_tag}}</td>
                <td>
                    <field_async_tag
                        v-model="field_async_tag"
                        :handleInvalidValue="handleTagInvalid"
                        :httpRequest="httpRequest.field_async_tag"
                    ></field_async_tag>
                </td>
            </tr>
            <tr>
                <td>field_async_tag_json</td>
                <td>{{field_async_tag_json}} || {{typeof field_async_tag_json}}</td>
                <td>
                    <field_async_tag_json
                        v-model="field_async_tag_json"
                        :handleInvalidValue="handleTagInvalid"
                        :httpRequest="httpRequest.field_async_tag_json"
                    ></field_async_tag_json>
                </td>
            </tr>



            <tr>
                <td>field_array_model</td>
                <td>{{field_array_model}}</td>
                <td>
                    <field_array_model
                        v-model="field_array_model"
                        :candidate="field_array_model_candidate"
                        placeholder="placeholder2"
                        labelfield="name"
                        valuefield="id"
                        :handleInvalidValue="handleTagInvalid"
                    ></field_array_model>
                </td>
            </tr>
            <tr>
                <td>field_array_model_json</td>
                <td>{{field_array_model_json}}</td>
                <td>
                    <field_array_model_json
                        v-model="field_array_model_json"
                        :candidate="field_array_model_candidate"
                        placeholder="placeholder2"
                        labelfield="name"
                        valuefield="id"
                        :handleInvalidValue="handleTagInvalid"
                    ></field_array_model_json>
                </td>
            </tr>




            <tr>
                <td>field_async_array_model</td>
                <td>{{field_async_array_model}}</td>
                <td>
                    <field_async_array_model
                        v-model="field_async_array_model"
                        labelfield="name"
                        valuefield="id"
                        :handleInvalidValue="handleTagInvalid"
                        :httpRequest="httpRequest.field_async_array_model"
                    ></field_async_array_model>
                </td>
            </tr>
            <tr>
                <td>field_async_array_model_json</td>
                <td>{{field_async_array_model_json}} || {{typeof field_async_array_model_json}}</td>
                <td>
                    <field_async_array_model_json
                        v-model="field_async_array_model_json"
                        labelfield="name"
                        valuefield="id"
                        :handleInvalidValue="handleTagInvalid"
                        :httpRequest="httpRequest.field_async_array_model_json"
                    ></field_async_array_model_json>
                </td>
            </tr>




            <tr>
                <td>field_relates_tag</td>
                <td>{{field_relates_tag}}</td>
                <td>
                    <field_relates_tag
                        v-model="field_relates_tag"
                        :relates="field_relates_tag_relates"
                        labelfield="name"
                        valuefield="id"
                        :handleInvalidValue="handleTagInvalid"
                        :handleInvalidRelateIds="handleInvalidRelateIds"
                        :httpRequest="httpRequest.field_relates_tag"
                    ></field_relates_tag>
                </td>
            </tr>
            <tr>
                <td>field_relates_tag_json</td>
                <td>{{field_relates_tag_json}} || {{typeof field_relates_tag_json}}</td>
                <td>
                    <field_relates_tag_json
                        v-model="field_relates_tag_json"
                        :relates="field_relates_tag_relates"
                        labelfield="name"
                        valuefield="id"
                        :handleInvalidValue="handleTagInvalid"
                        :handleInvalidRelateIds="handleInvalidRelateIds"
                        :httpRequest="httpRequest.field_relates_tag_json"
                    ></field_relates_tag_json>
                </td>
            </tr>



            <tr>
                <td>field_relates_array_model</td>
                <td>{{field_relates_array_model}}</td>
                <td>
                    <field_relates_array_model
                        v-model="field_relates_array_model"
                        :relates="field_relates_model_relates"
                        labelfield="name"
                        valuefield="id"
                        :handleInvalidValue="handleTagInvalid"
                        :httpRequest="httpRequest.field_relates_array_model"
                    ></field_relates_array_model>
                </td>
            </tr>
            <tr>
                <td>field_relates_array_model_json</td>
                <td>{{field_relates_array_model_json}} || {{typeof field_relates_array_model_json}}</td>
                <td>
                    <field_relates_array_model_json
                        v-model="field_relates_array_model_json"
                        :relates="field_relates_model_relates"
                        labelfield="name"
                        valuefield="id"
                        :handleInvalidValue="handleTagInvalid"
                        :httpRequest="httpRequest.field_relates_array_model_json"
                    ></field_relates_array_model_json>
                </td>
            </tr>



        </tbody>
    </table>
</section>
</template>

<script>
import {observe_relates} from "@/components/common/editor/field_relates_helper.js"

import {unique,clearInvalidData} from "@/components/common/editor/_validate_option"

import axios from "@/server/axios"

const fields = {
    field_async_tag:"field_async_tag",
    field_async_tag_json:"field_async_tag",
    field_async_array_model:"field_async_array_model",
    field_async_array_model_json:"field_async_array_model",
    field_relates_tag:"field_relates_tag",
    field_relates_tag_json:"field_relates_tag",
    field_relates_array_model:"field_relates_array_model",
    field_relates_array_model_json:"field_relates_array_model",
}

const httpRequest = Object.keys(fields).reduce((obj,field)=>{
    obj[field] = function(cb){
        axios.get(`/test/${fields[field]}`).then((json)=>{
            cb(json.data.data);
        });
    }
    return obj;
},{})


export default{
    config:{
        field_tag_candidate:[
            {value:1,label:'aaa'},
            {value:2,label:'bbb'},
            {value:3,label:"ccc"},
            {value:4,label:"ddd"},
            {value:5,label:"eee"}
        ],
        field_array_model_candidate:[
            {id:1,name:"太年轻"},
            {id:2,name:"太天真"},
            {id:3,name:"亦可赛艇"},
            {id:4,name:"exciting"},
            {id:5,name:"simple"},
            {id:6,name:"naive"}
        ],
        field_relates_tag_relates:[
            {
                relateField:"relates",
                invalidValue:"",
                requestField:"sex"
            },
        ],
        field_relates_model_relates:[
            {
                relateField:"relates",
                invalidValue:"",
                requestField:"sex"
            },

        ],
        handleTagInvalid:function(value,allvalue){
            this.$emit('input',clearInvalidData(value,allvalue))
        },
        handleInvalidRelateIds:function(){
            console.log(this)
        },
        httpRequest,
    },
    components:{
        field_tag:()=>import("@/components/common/editor/field_tag"),
        field_tag_json:()=>import("@/components/common/editor/field_tag_json"),
        field_async_tag:()=>import("@/components/common/editor/field_async_tag"),
        field_async_tag_json:()=>import("@/components/common/editor/field_async_tag_json"),
        field_array_model:()=>import("@/components/common/editor/field_array_model"),
        field_array_model_json:()=>import("@/components/common/editor/field_array_model_json"),
        field_async_array_model:()=>import("@/components/common/editor/field_async_array_model"),
        field_async_array_model_json:()=>import("@/components/common/editor/field_async_array_model_json"),
        field_relates_tag:()=>import("@/components/common/editor/field_relates_tag"),
        field_relates_tag_json:()=>import("@/components/common/editor/field_relates_tag_json"),
        field_relates_array_model:()=>import("@/components/common/editor/field_relates_array_model"),
        field_relates_array_model_json:()=>import("@/components/common/editor/field_relates_array_model_json"),
    },
    data(){
        return {
            relates:"",
            field_tag:[1,1,5,7],
            field_tag_json:"",
            field_async_tag:[1,1,9],
            field_async_tag_json:"",
            field_array_model:[2,2,8],
            field_array_model_json:"",
            field_async_array_model:[2,2,8],
            field_async_array_model_json:"",
            field_relates_tag:[2,2,8],
            field_relates_tag_json:"[2,2,8]",
            field_relates_array_model:[2,2,8],
            field_relates_array_model_json:"[2,2,8]",
        }
    },
    created(){
        observe_relates(this.field_relates_tag_relates,this)
        observe_relates(this.field_relates_model_relates,this)

        setTimeout(()=>{
            // this.field_tag = [1,1,5,7];
            // this.field_async_tag = [5];
            // this.field_async_array_model = [2]
        },1000)
    }
}
</script>